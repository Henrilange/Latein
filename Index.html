<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Translate Latin AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden { display: none; }
        .tab-active { border-bottom: 4px solid #a855f7; color: #e9d5ff; background: rgba(147, 51, 234, 0.2); }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen font-sans">

    <div class="max-w-2xl mx-auto p-4">
        <header class="bg-slate-800 border border-purple-500/30 rounded-2xl p-6 text-center mb-6 shadow-2xl">
            <h1 class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-pink-400">
                Translate Latin AI
            </h1>
            <p class="text-xs text-slate-400 mt-2">by Henri Lange</p>
        </header>

        <nav class="flex bg-slate-800 rounded-xl overflow-hidden border border-purple-500/20 mb-6">
            <button onclick="showTab('vocab')" id="btn-vocab" class="flex-1 py-4 font-bold tab-active">Vokabeln</button>
            <button onclick="showTab('quiz')" id="btn-quiz" class="flex-1 py-4 font-bold text-slate-400">Quiz</button>
            <button onclick="showTab('translate')" id="btn-translate" class="flex-1 py-4 font-bold text-slate-400">Ãœbersetzer</button>
        </nav>

        <div class="mb-6">
            <input type="password" id="api-key" placeholder="OpenAI API Key hier einfÃ¼gen..." 
                   class="w-full p-3 bg-slate-800 border border-purple-500/50 rounded-xl text-sm outline-none focus:border-purple-400">
        </div>

        <section id="tab-vocab" class="space-y-6">
            <div class="bg-slate-800 p-6 rounded-2xl border border-purple-500/20 shadow-lg">
                <h2 class="font-bold text-purple-300 mb-4 flex items-center gap-2">Vokabeln hinzufÃ¼gen</h2>
                <div class="grid grid-cols-2 gap-2 mb-4">
                    <input type="text" id="in-latin" placeholder="Latein" class="p-3 bg-slate-700 rounded-lg outline-none">
                    <input type="text" id="in-german" placeholder="Deutsch" class="p-3 bg-slate-700 rounded-lg outline-none">
                </div>
                <button onclick="addVocabManual()" class="w-full bg-indigo-600 py-3 rounded-xl font-bold mb-4">HinzufÃ¼gen</button>
                
                <button onclick="toggleLessons()" class="w-full bg-emerald-600 py-3 rounded-xl font-bold mb-4">ðŸ“š Vokabeln</button>
                
                <div id="lesson-menu" class="hidden mb-4 bg-slate-700/50 rounded-xl p-4 space-y-2">
                    <button onclick="toggleLesson1()" class="w-full bg-slate-600 py-2 rounded-lg font-bold text-left px-4 hover:bg-slate-500">â–¶ Lektion 1</button>
                    <div id="lesson-1-vocabs" class="hidden pl-4 space-y-1 mt-2">
                        <button onclick="addLesson1()" class="w-full bg-purple-600 hover:bg-purple-500 py-2 rounded-lg text-sm">Alle Vokabeln hinzufÃ¼gen</button>
                    </div>
                </div>
                
                <div class="relative">
                    <input type="file" id="file-input" class="hidden" accept="image/*" onchange="handleImgUpload(event)">
                    <button onclick="document.getElementById('file-input').click()" id="btn-scan" 
                            class="w-full bg-purple-600 py-3 rounded-xl font-bold flex justify-center items-center gap-2">
                        <span>ðŸ“· Foto scannen</span>
                    </button>
                </div>
            </div>

            <div class="bg-slate-800 p-6 rounded-2xl border border-purple-500/20">
                <h3 class="font-bold text-purple-300 mb-4">Deine Liste</h3>
                <div id="vocab-list" class="space-y-2 max-h-64 overflow-y-auto">
                    </div>
            </div>
        </section>

        <section id="tab-quiz" class="hidden space-y-6 text-center py-10">
            <div id="quiz-start">
                <button onclick="startQuiz()" class="bg-purple-600 px-10 py-5 rounded-2xl font-bold text-xl shadow-lg">Quiz starten</button>
            </div>
            <div id="quiz-box" class="hidden bg-slate-800 p-8 rounded-2xl border border-purple-500/20">
                <p class="text-sm text-purple-400 uppercase tracking-widest mb-2">Was bedeutet:</p>
                <h2 id="quiz-question" class="text-4xl font-bold mb-8">...</h2>
                <input type="text" id="quiz-input" placeholder="Antwort..." class="w-full p-4 bg-slate-700 rounded-xl text-center text-xl mb-4 outline-none border-2 border-transparent focus:border-purple-500">
                <div id="quiz-feedback" class="mb-4 font-bold hidden"></div>
                <button id="quiz-btn" onclick="checkAnswer()" class="w-full bg-indigo-600 py-4 rounded-xl font-bold">PrÃ¼fen</button>
            </div>
        </section>

        <section id="tab-translate" class="hidden space-y-4">
            <textarea id="trans-input" class="w-full h-40 bg-slate-800 border border-purple-500/20 rounded-2xl p-4 outline-none focus:border-purple-500" placeholder="Lateinischen Text hier einfÃ¼gen..."></textarea>
            
            <div class="relative">
                <input type="file" id="trans-file-input" class="hidden" accept="image/*" onchange="handleTransImgUpload(event)">
                <button onclick="document.getElementById('trans-file-input').click()" id="btn-trans-scan" 
                        class="w-full bg-indigo-600 py-3 rounded-xl font-bold flex justify-center items-center gap-2">
                    <span>ðŸ“· Text aus Foto extrahieren</span>
                </button>
            </div>
            
            <button onclick="translateText()" id="btn-trans" class="w-full bg-purple-600 py-4 rounded-2xl font-bold">Ãœbersetzen mit ChatGPT</button>
            <div id="trans-result" class="hidden bg-emerald-900/20 border border-emerald-500/30 p-6 rounded-2xl">
                <h4 class="text-emerald-400 font-bold mb-2">Ergebnis:</h4>
                <p id="trans-output" class="text-lg"></p>
            </div>
        </section>
    </div>

    <script>
        // --- DATA & STATE ---
        let vocabs = JSON.parse(localStorage.getItem('latin-v1')) || [];
        let currentQuizItem = null;

        // Vorgefertigte Vokabeln - Lektion 1
        const lesson1Vocabs = [
            { la: "sol", de: "die Sonne" },
            { la: "ardere", de: "(ver)brennen; entbrannt sein" },
            { la: "silentium", de: "die Ruhe, die Stille; das Schweigen" },
            { la: "esse", de: "sein" },
            { la: "villa", de: "das (Land-)Haus; das Landgut" },
            { la: "iacere", de: "(da)liegen" },
            { la: "etiam", de: "auch; sogar" },
            { la: "canis", de: "der Hund" },
            { la: "tacere", de: "schweigen, still sein" },
            { la: "asinus", de: "der Esel" },
            { la: "non iam", de: "nicht mehr" },
            { la: "clamare", de: "schreien, (laut) rufen" },
            { la: "stare", de: "(da)stehen" },
            { la: "et", de: "und; auch" },
            { la: "exspectare", de: "warten (auf), erwarten" },
            { la: "ubi", de: "wo?" },
            { la: "cur", de: "warum?" },
            { la: "amica", de: "die Freundin" },
            { la: "non", de: "nicht" },
            { la: "venire", de: "kommen" },
            { la: "cessare", de: "zÃ¶gern; sich Zeit lassen" },
            { la: "placere", de: "gefallen; SpaÃŸ machen" },
            { la: "subito", de: "plÃ¶tzlich" },
            { la: "quis/quid", de: "wer?/was?" },
            { la: "ecce", de: "schau!/schaut!, sieh da!/seht!" }
        ];

        // --- LESSON MENU FUNCTIONS ---
        function toggleLessons() {
            const menu = document.getElementById('lesson-menu');
            menu.classList.toggle('hidden');
        }

        function toggleLesson1() {
            const vocabList = document.getElementById('lesson-1-vocabs');
            vocabList.classList.toggle('hidden');
        }

        function addLesson1() {
            lesson1Vocabs.forEach(vocab => {
                // Nur hinzufÃ¼gen wenn nicht bereits vorhanden
                const exists = vocabs.some(v => v.la === vocab.la && v.de === vocab.de);
                if (!exists) {
                    vocabs.push(vocab);
                }
            });
            renderVocabs();
            alert("Lektion 1 Vokabeln wurden hinzugefÃ¼gt!");
        }

        // --- NAVIGATION ---
        function showTab(tabId) {
            ['vocab', 'quiz', 'translate'].forEach(id => {
                document.getElementById(`tab-${id}`).classList.add('hidden');
                document.getElementById(`btn-${id}`).classList.remove('tab-active', 'text-slate-100');
                document.getElementById(`btn-${id}`).classList.add('text-slate-400');
            });
            document.getElementById(`tab-${tabId}`).classList.remove('hidden');
            document.getElementById(`btn-${tabId}`).classList.add('tab-active', 'text-slate-100');
        }

        // --- VOKABEL LOGIK ---
        function renderVocabs() {
            const listDiv = document.getElementById('vocab-list');
            listDiv.innerHTML = vocabs.length ? '' : '<p class="text-slate-500 italic text-sm text-center">Noch keine Vokabeln vorhanden.</p>';
            
            vocabs.slice().reverse().forEach((v, index) => {
                const item = document.createElement('div');
                item.className = "flex justify-between bg-slate-700/30 p-3 rounded-lg border border-white/5 items-center";
                item.innerHTML = `
                    <div><span class="text-purple-300 font-bold">${v.la}</span> <span class="text-slate-500 mx-2">â†’</span> <span>${v.de}</span></div>
                    <button onclick="deleteVocab(${vocabs.length - 1 - index})" class="text-red-400 text-sm">LÃ¶schen</button>
                `;
                listDiv.appendChild(item);
            });
            localStorage.setItem('latin-v1', JSON.stringify(vocabs));
        }

        function addVocabManual() {
            const la = document.getElementById('in-latin').value;
            const de = document.getElementById('in-german').value;
            if(!la || !de) return;
            vocabs.push({ la, de });
            document.getElementById('in-latin').value = '';
            document.getElementById('in-german').value = '';
            renderVocabs();
        }

        function deleteVocab(index) {
            vocabs.splice(index, 1);
            renderVocabs();
        }

        // --- OPENAI API LOGIK ---
        async function callOpenAI(messages) {
            const apiKey = document.getElementById('api-key').value;
            if(!apiKey) { alert("Bitte erst den OpenAI API Key oben eingeben!"); return; }

            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}` },
                body: JSON.stringify({ model: 'gpt-4o', messages, temperature: 0.3 })
            });
            const data = await response.json();
            if(data.error) throw new Error(data.error.message);
            return data.choices[0].message.content;
        }

        async function handleImgUpload(event) {
            const file = event.target.files[0];
            if(!file) return;

            const btn = document.getElementById('btn-scan');
            btn.innerText = "â³ Verarbeite Bild...";
            btn.disabled = true;

            const reader = new FileReader();
            reader.onload = async (e) => {
                const base64 = e.target.result;
                try {
                    const response = await callOpenAI([
                        { role: "user", content: [
                            { type: "text", text: "Extrahiere Vokabeln. Format: Latein - Deutsch. Pro Zeile ein Paar." },
                            { type: "image_url", image_url: { url: base64 } }
                        ]}
                    ]);
                    
                    const lines = response.split('\n').filter(l => l.includes('-'));
                    lines.forEach(line => {
                        const [la, de] = line.split('-').map(s => s.trim());
                        if(la && de) vocabs.push({ la, de });
                    });
                    renderVocabs();
                } catch (err) { alert("Fehler: " + err.message); }
                btn.innerText = "ðŸ“· Foto scannen";
                btn.disabled = false;
            };
            reader.readAsDataURL(file);
        }

        async function handleTransImgUpload(event) {
            const file = event.target.files[0];
            if(!file) return;

            const btn = document.getElementById('btn-trans-scan');
            btn.innerText = "â³ Extrahiere Text...";
            btn.disabled = true;

            const reader = new FileReader();
            reader.onload = async (e) => {
                const base64 = e.target.result;
                try {
                    const response = await callOpenAI([
                        { role: "user", content: [
                            { type: "text", text: "Extrahiere den gesamten lateinischen Text aus diesem Bild. Gib nur den Text zurÃ¼ck, ohne zusÃ¤tzliche ErklÃ¤rungen." },
                            { type: "image_url", image_url: { url: base64 } }
                        ]}
                    ]);
                    
                    document.getElementById('trans-input').value = response.trim();
                } catch (err) { alert("Fehler: " + err.message); }
                btn.innerText = "ðŸ“· Text aus Foto extrahieren";
                btn.disabled = false;
            };
            reader.readAsDataURL(file);
        }

        async function translateText() {
            const text = document.getElementById('trans-input').value;
            if(!text) return;
            
            const btn = document.getElementById('btn-trans');
            btn.innerText = "â³ Ãœbersetze...";
            
            try {
                const vocabCtx = vocabs.map(v => `${v.la}=${v.de}`).join('\n');

                const result = await callOpenAI([
                    { role: "system", content: "Du bist ein Lateinlehrer. Ãœbersetze den lateinischen Text ins Deutsche. WICHTIGE REGELN - BEFOLGE SIE STRIKT:\n\n1. VOKABELN - SEHR WICHTIG: Du darfst AUSSCHLIESSLICH Vokabeln verwenden, die in der bereitgestellten Liste stehen!\n   - KEINE anderen Ãœbersetzungen erlaubt!\n   - KEINE Synonyme!\n   - KEINE eigenen Vokabelkenntnisse verwenden!\n\n2. GRAMMATIK-ERKENNUNG: Erkenne flektierte Formen und fÃ¼hre sie auf ihre Grundform zurÃ¼ck!\n   - Beispiel: 'ardet' â†’ Grundform 'ardere' â†’ NUR wenn 'ardere' in der Liste steht â†’ Ã¼bersetze als 'er/sie/es brennt'\n   - Beispiel: 'ardet' â†’ Grundform 'ardere' â†’ NICHT in der Liste â†’ schreibe '[unbekannt]'\n   - Beispiel: 'puellam' â†’ Grundform 'puella' â†’ NUR wenn 'puella' in der Liste â†’ Ã¼bersetze mit korrektem deutschen Fall\n   - PrÃ¼fe fÃ¼r JEDES Wort: Ist die Grundform in der Vokabelliste? JA=Ã¼bersetzen, NEIN=[unbekannt]\n\n3. EIGENNAMEN: Erkenne rÃ¶mische/lateinische Eigennamen (Personen, GÃ¶tter, Orte)\n   - Beispiele: Marcus, Iulia, Caesar, Venus, Roma, Rhenus, Claudius, Augustus\n   - Diese Namen bleiben unverÃ¤ndert im Original\n   - Namen werden NICHT als [unbekannt] markiert\n\n4. UNBEKANNTE WÃ–RTER: Jedes Wort, dessen Grundform NICHT in der Vokabelliste steht UND das KEIN Eigenname ist â†’ '[unbekannt]'\n   - Das ist NICHT verhandelbar!\n   - Auch wenn du das Wort kennst - wenn es nicht in der Liste steht â†’ '[unbekannt]'\n\n5. DEUTSCHE GRAMMATIK: Ãœbersetze bekannte WÃ¶rter mit korrekter deutscher Grammatik\n\n6. Antworte NUR mit der deutschen Ãœbersetzung" },
                    { role: "user", content: "Vokabelliste (Latein=Deutsch):\n" + vocabCtx + "\n\nZu Ã¼bersetzender lateinischer Text:\n" + text }
                ]);

                document.getElementById('trans-output').innerText = result;
                document.getElementById('trans-result').classList.remove('hidden');
            } catch (err) { alert(err.message); }
            btn.innerText = "Ãœbersetzen mit ChatGPT";
        }

        // --- QUIZ LOGIK ---
        function startQuiz() {
            if(vocabs.length === 0) return alert("Erst Vokabeln hinzufÃ¼gen!");
            document.getElementById('quiz-start').classList.add('hidden');
            document.getElementById('quiz-box').classList.remove('hidden');
            nextQuizItem();
        }

        function nextQuizItem() {
            currentQuizItem = vocabs[Math.floor(Math.random() * vocabs.length)];
            document.getElementById('quiz-question').innerText = currentQuizItem.la;
            document.getElementById('quiz-input').value = '';
            document.getElementById('quiz-feedback').classList.add('hidden');
            document.getElementById('quiz-btn').innerText = "PrÃ¼fen";
            document.getElementById('quiz-btn').onclick = checkAnswer;
        }

        function checkAnswer() {
            const userAns = document.getElementById('quiz-input').value.trim().toLowerCase();
            const correctAns = currentQuizItem.de.toLowerCase();
            const feedback = document.getElementById('quiz-feedback');
            
            feedback.classList.remove('hidden');
            if(userAns === correctAns) {
                feedback.innerText = "Richtig! âœ¨";
                feedback.className = "mb-4 font-bold text-emerald-400";
            } else {
                feedback.innerText = "Falsch. LÃ¶sung: " + currentQuizItem.de;
                feedback.className = "mb-4 font-bold text-red-400";
            }
            
            document.getElementById('quiz-btn').innerText = "NÃ¤chste Frage";
            document.getElementById('quiz-btn').onclick = nextQuizItem;
        }

        // Initialer Aufruf
        renderVocabs();
    </script>
</body>
</html>
